{{- define "ViewModel" }}
{{- $ctx := . -}}
{{- $v   := $ctx.view -}}
{{- $schema := $ctx.schema -}}
{{- $viewName := exec "Title" $v.Name | exec "Singular" -}}
{{- $schemaName := lower $schema.Name -}}
{{- $fileName := printf "%s__%s.go" $schemaName (lower $v.Name) -}}

-- {{ $fileName }} --
// Code generated by gen-views. DO NOT EDIT.
package views

type {{ $viewName }} struct {
  {{- range $c := $v.Columns }}
    {{- $col := $c.Name -}}
    {{- $field := exec "FieldName" $col -}}
    {{- $goType := exec "ResolveType" (dict "root" $ctx.root "col" $c "schema" $schema) -}}
    {{- printf "\n    %s %s `gorm:\"column:%s;->\"`" $field $goType $col -}}
  {{- end }}
}

func ({{ $viewName }}) TableName() string { return "{{ $schema.Name }}.{{ $v.Name }}" }

{{ template "ColsStruct" (dict "Table" $v "TableName" $viewName) }}
{{- end }}

{{- $acc := "" -}}
{{- $root := . -}}
{{- range $schema := $root.Realm.Schemas }}
  {{- range $v := $schema.Views }}
    {{- $acc = printf "%s%s\n\n" $acc (include "ViewModel" (dict "view" $v "root" $root "schema" $schema)) -}}
  {{- end }}
{{- end }}
{{- $acc | txtar | write "gen/views" -}}

