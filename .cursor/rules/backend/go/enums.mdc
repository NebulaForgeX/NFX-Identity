---
description: 后端 Go Enums 编码规范 - 数据库枚举（自动生成）
globs:
  - '**/enums/**/*.go'
alwaysApply: false
---

# Enums 编码规范

本规则说明 **enums/** 的用途与生成方式，适用于从数据库 Schema（如 PostgreSQL ENUM）生成 Go 枚举的项目。enums 目录下的文件由脚本/模板自动生成，**不可手动编辑**；业务常量放在 constants/。

## 与 Constants 的区别

- **Enums（本规范）**：由 Atlas 从数据库 PostgreSQL ENUM 类型自动生成，**不可手动编辑**
- **Constants**：手动编写的业务常量，用于业务逻辑配置（如超时时间、重试次数等）

## 生成方式

Enums 由以下流程自动生成：

1. **数据库 Schema 定义**：在 `databases/src/schemas/<module>/tables/<table>.sql` 中定义 PostgreSQL ENUM 类型
2. **Atlas 检查**：运行 `atlas schema inspect --env gen-enums` 检查 Schema
3. **模板生成**：使用 `databases/templates/gen_enums.tmpl` 模板生成 Go 代码
4. **脚本执行**：运行 `databases/scripts/gen_enums.sh` 或 `gen_enums.ps1` 执行生成
5. **文件输出**：生成的代码输出到 `enums/` 目录

## 文件组织

```
enums/
├── <module>_<enum_name>_enum_dbgen.go  # 自动生成的枚举文件
└── ...
```

**注意**：所有文件都是自动生成的，**不要手动创建或编辑**

## 生成的文件格式

```go
// ✅ GOOD - 自动生成的枚举文件（示例）
// Code generated by gen-enums. DO NOT EDIT.

package enums

type <Module><EnumName> string

const (
    <Module><EnumName>Value1 <Module><EnumName> = "value1"
    <Module><EnumName>Value2 <Module><EnumName> = "value2"
    <Module><EnumName>Value3 <Module><EnumName> = "value3"
)
```

## 数据库 ENUM 定义

```sql
-- ✅ GOOD - 在数据库 Schema 中定义枚举类型
-- 文件：databases/src/schemas/<module>/tables/<table>.sql
CREATE TYPE "<module>".<enum_name> AS ENUM ('value1', 'value2', 'value3');
```

## 命名规范

- **枚举类型名**：使用 `PascalCase`，格式为 `<Module><EnumName>`: `DirectoryUserStatus`, `AuthSessionStatus`
- **枚举常量**：使用 `PascalCase`，格式为 `<Module><EnumName><Value>`: `DirectoryUserStatusActive`, `DirectoryUserStatusPending`
- **文件命名**：使用 `<module>_<enum_name>_enum_dbgen.go` 格式: `directory_user_enum_dbgen.go`

## 重要提示

⚠️ **不要手动编辑**：
- 所有 `enums/` 目录下的文件都是自动生成的
- 文件头部标注 `// Code generated by gen-enums. DO NOT EDIT.`
- 手动创建或修改的文件会在下次生成时被**清空和覆盖**

⚠️ **如何修改枚举**：
1. 修改数据库 Schema 中的 ENUM 定义（`databases/src/schemas/.../*.sql`）
2. 生成迁移文件：`atlas migrate diff --env dev`
3. 应用迁移：`atlas migrate apply --env dev`
4. 重新生成枚举：运行 `databases/scripts/gen_enums.sh`

## 实现建议

- **在 Schema 中定义**：枚举值在数据库 Schema 的 SQL 文件中定义
- **使用迁移管理**：枚举值的变更通过数据库迁移进行
- **自动生成代码**：使用 Atlas + 模板自动生成 Go 枚举代码
- **不要手动编辑**：永远不要手动创建或修改 `enums/` 目录下的文件
- **版本控制**：生成的枚举文件应该提交到版本控制，但标记为自动生成
