---
description: 前端 APIs 文件夹编码规范 - 接口与路径管理
globs:
  - '**/src/apis/**/*.ts'
alwaysApply: false
---

# APIs 编码规范

本规则说明如何组织与编写 **apis/** 下的代码，适用于任意对接 REST 的前端项目。

## 文件组织

```
apis/
├── clients.ts       # HTTP 客户端（如 protectedClient、publicClient）
├── ip.ts            # 或 path.ts / endpoints.ts：路径常量
├── index.ts         # 统一导出
├── <module>.api.ts  # 各模块 API 函数（如 user.api.ts、auth.api.ts）
└── ...
```

按业务模块拆分 API 文件，路径集中在一个文件中便于维护。

## 路径管理

### 路径常量结构

```typescript
// ip.ts 或 path.ts
export const URL_PATHS = {
  USER: {
    CREATE: "/users",
    GET: "/users/:id",
    UPDATE: "/users/:id",
    DELETE: "/users/:id",
    LIST_BY_ORG: "/orgs/:orgId/users",
  },
  AUTH: {
    LOGIN: "/auth/login",
    LOGOUT: "/auth/logout",
  },
} as const;
```

- 按模块分组，键 UPPER_SNAKE_CASE
- 路径参数用 `:id`、`:orgId` 等占位，调用时用 `.replace(":id", id)` 替换

### 路径参数处理

```typescript
const url = URL_PATHS.USER.GET.replace(":id", id);
// 多参数时链式 replace 或封装成小函数
```

## API 函数结构

### 标准写法

```typescript
// <module>.api.ts
import type { User, CreateUserRequest, DataResponse, BaseResponse } from "@/types";
import { protectedClient } from "./clients";
import { URL_PATHS } from "./ip";

export const CreateUser = async (params: CreateUserRequest): Promise<User> => {
  const { data } = await protectedClient.post<DataResponse<User>>(URL_PATHS.USER.CREATE, params);
  return data.data;
};

export const GetUser = async (id: string): Promise<User> => {
  const url = URL_PATHS.USER.GET.replace(":id", id);
  const { data } = await protectedClient.get<DataResponse<User>>(url);
  return data.data;
};

export const UpdateUser = async (id: string, body: UpdateUserRequest): Promise<BaseResponse> => {
  const url = URL_PATHS.USER.UPDATE.replace(":id", id);
  const { data } = await protectedClient.patch<BaseResponse>(url, body);
  return data;
};

export const DeleteUser = async (id: string): Promise<BaseResponse> => {
  const url = URL_PATHS.USER.DELETE.replace(":id", id);
  const { data } = await protectedClient.delete<BaseResponse>(url);
  return data;
};
```

- 有响应体：用 `DataResponse<T>`，返回 `data.data`
- 仅状态码：用 `BaseResponse`，返回 `data` 或按项目约定
- 使用类型导入：`import type { ... }` 避免运行时引入类型

## 命名规范

- **API 函数**：PascalCase，动词开头  
  - CRUD：`CreateUser`、`GetUser`、`UpdateUser`、`DeleteUser`  
  - 查询变体：`GetUserByEmail`、`GetUsersByOrgID`  
  - 动作：`SetPrimaryEmail`、`VerifyPhone`
- **文件名**：kebab-case，`<module>.api.ts`
- **路径常量**：UPPER_SNAKE_CASE

## 客户端使用

- **需鉴权**：使用 `protectedClient`（拦截器自动加 token、处理 401 等）
- **公开接口**：使用 `publicClient`（登录、注册、公开接口）
- 不在 API 层做弹窗、路由；错误由调用方或上层（如 React Query、hooks）处理

## HTTP 方法约定

- 创建：`POST`，body 传参
- 单条查询：`GET`，路径参数
- 全量更新：`PUT`；部分更新：`PATCH`
- 删除：`DELETE`

## 实现建议

- 每个模块一个 `<module>.api.ts`，内部用注释分块（如 `// ========== 用户 ==========`）
- 所有 API 通过 `index.ts` 再导出，便于 hooks 层统一从 `@/apis` 引用
